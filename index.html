<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Focus Pro V11</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Fira+Code:wght@400;700&family=Inter:wght@400;700&family=JetBrains+Mono:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Roboto+Mono:wght@400;700&family=Space+Mono:wght@400;700&family=Ubuntu+Mono:wght@400;700&family=Orbitron:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #000000;
            --accent-color: #ffffff;
            --pulse-color: #1a1a1a;
            --ms-color: rgba(255, 255, 255, 0.3);
            --chip-bg: #111111;
            --text-font: 'Montserrat', sans-serif;
            --font-weight: 700;
            --display-size: 20vw;
            --anim-speed: 2s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--accent-color);
            font-family: var(--text-font);
            font-weight: var(--font-weight);
            height: 100dvh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: background-color 0.5s ease, color 0.3s ease;
        }

        .ui-element {
            z-index: 1000;
            position: relative;
            transition: opacity 0.3s ease;
        }

        body.focus-active .ui-element {
            display: none !important;
        }

        #display-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            width: 100%;
            position: relative;
            z-index: 100;
        }

        #main-display {
            font-variant-numeric: tabular-nums;
            font-size: var(--display-size);
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            text-align: center;
            white-space: nowrap;
        }

        .sub-seconds {
            font-size: 0.4em;
            color: var(--ms-color);
            margin-left: 0.1em;
        }

        #status-text {
            position: absolute;
            top: 15%;
            font-size: clamp(1rem, 4vw, 2rem);
            display: none;
            text-transform: uppercase;
            letter-spacing: 5px;
            text-align: center;
            width: 100%;
            z-index: 150;
        }

        body.timer-finished {
            animation: pulseBg var(--anim-speed) infinite ease-in-out;
        }

        @keyframes pulseBg {

            0%,
            100% {
                background-color: var(--bg-color);
            }

            50% {
                background-color: var(--pulse-color);
            }
        }

        .modes {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1100;
        }

        .mode-btn {
            opacity: 0.3;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 800;
            padding: 10px;
        }

        .mode-btn.active {
            opacity: 1;
            border-bottom: 2px solid var(--accent-color);
        }

        #gear {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.5;
            z-index: 1100;
            padding: 10px;
        }

        #fullscreen-ghost {
            position: absolute;
            bottom: 20px;
            right: 20px;
            opacity: 0.15;
            cursor: pointer;
            z-index: 1100;
            padding: 10px;
        }

        .controls {
            margin-top: 2.5rem;
            display: flex;
            gap: 15px;
        }

        button {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        #settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 2000;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .setting-item {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        input,
        select {
            background: #111;
            color: white;
            border: 1px solid #333;
            padding: 10px;
            border-radius: 8px;
            font-family: inherit;
        }

        .time-inputs {
            display: flex;
            gap: 5px;
        }

        .time-inputs input {
            width: 70px;
            text-align: center;
        }

        .val-badge {
            font-size: 0.7rem;
            opacity: 0.6;
            background: #222;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .chip-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .chip-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #444;
            background: var(--chip-bg);
            color: #888;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .chip-btn.active {
            background: var(--accent-color) !important;
            color: var(--bg-color);
            border-color: var(--accent-color);
        }
    </style>
</head>

<body id="body" onclick="handleGlobalClick()">

    <div id="gear" class="ui-element" onclick="toggleSettings(event)">⚙️</div>

    <div id="fullscreen-ghost" class="ui-element" onclick="toggleFullscreen(event)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
            </path>
        </svg>
    </div>

    <div class="modes ui-element">
        <div class="mode-btn active" data-mode="timer" onclick="setMode('timer', event)">TIMER</div>
        <div class="mode-btn" data-mode="stopwatch" onclick="setMode('stopwatch', event)">STOPWATCH</div>
        <div class="mode-btn" data-mode="clock" onclick="setMode('clock', event)">CLOCK</div>
    </div>

    <div id="display-wrapper">
        <div id="status-text">SÜRE DOLDU</div>
        <div id="chip-container" class="chip-container ui-element"></div>
        <div id="main-display">25:00</div>
        <div class="controls ui-element">
            <button id="start-btn" onclick="toggleStart(event)">
                <svg id="play-icon" viewBox="0 0 24 24" style="width:20px; height:20px; fill:currentColor;">
                    <path d="M8 5v14l11-7z" />
                </svg>
                <span id="btn-text">BAŞLAT</span>
            </button>
            <button onclick="reset(event)">
                <svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:currentColor;">
                    <path
                        d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                </svg>
                SIFIRLA
            </button>
        </div>
    </div>

    <div id="settings-panel" onclick="event.stopPropagation()">
        <h2 style="margin-bottom: 25px;">AYARLAR</h2>

        <div class="setting-item">
            <label>Süre Girişi (HH : MM : SS)</label>
            <div class="time-inputs">
                <input type="number" id="h-in" value="0" min="0" oninput="updateFromCustom()">
                <input type="number" id="m-in" value="25" min="0" oninput="updateFromCustom()">
                <input type="number" id="s-in" value="0" min="0" oninput="updateFromCustom()">
            </div>
        </div>

        <div class="setting-item">
            <label>Görünüm</label>
            <select id="f-family" onchange="applySettings()">
                <option value="'Montserrat'">Montserrat</option>
                <option value="'JetBrains Mono'">JetBrains Mono</option>
                <option value="'Orbitron'">Orbitron</option>
                <option value="'Bebas Neue'">Bebas Neue</option>
            </select>
            <div class="setting-row">
                <span>Boyut: <span id="v-size" class="val-badge">20vw</span></span>
                <input type="range" id="f-size" min="5" max="50" value="20" oninput="applySettings()">
            </div>
            <div class="setting-row">
                <span>Kalınlık: <span id="v-weight" class="val-badge">700</span></span>
                <input type="range" id="f-weight" min="100" max="900" step="100" value="700" oninput="applySettings()">
            </div>
        </div>

        <div class="setting-item">
            <label>Titreşim Ayarları</label>
            <div class="setting-row"><span>Titreşim Seviyesi: <span id="v-vib-lvl"
                        class="val-badge">3</span></span><input type="range" id="vib-lvl" min="1" max="5" value="3"
                    oninput="applySettings()"></div>
            <label style="display: flex; gap:10px; cursor: pointer;"><input type="checkbox" id="vibrate-on" checked>
                Bitişte Titreşimi Başlat</label>
            <div class="setting-row">
                <span>Bitiş Puls Rengi</span>
                <input type="color" id="c-pulse" value="#1a1a1a" onchange="applySettings()">
            </div>
            <div class="setting-row">
                <span>Animasyon Hızı (sn): <span id="v-anim" class="val-badge">2s</span></span>
                <input type="number" id="p-speed" value="2" step="0.5" style="width:70px" onchange="applySettings()">
            </div>
        </div>

        <div class="setting-item">
            <label>Renkler</label>
            <div class="setting-row"><span>Arkaplan</span><input type="color" id="c-bg" value="#000000"
                    onchange="applySettings()"></div>
            <div class="setting-row"><span>Yazı</span><input type="color" id="c-txt" value="#ffffff"
                    onchange="applySettings()"></div>
            <div class="setting-row"><span>Milisaniye</span><input type="color" id="c-ms" value="#666666"
                    onchange="applySettings()"></div>
            <div class="setting-row"><span>Preset Buton (Chip)</span><input type="color" id="c-chip" value="#111111"
                    onchange="applySettings()"></div>
        </div>

        <div class="setting-item">
            <label>Preset Yönetimi</label>
            <div id="chip-manager-list"></div>
            <button onclick="addChip()" style="width:100%; border-style: dashed; opacity: 0.6;">+ Yeni Preset</button>
        </div>

        <div class="setting-item">
            <label style="display: flex; gap:10px; cursor: pointer;"><input type="checkbox" id="pause-on" checked>
                Dokununca Durdur</label>
            <label style="display: flex; gap:10px; cursor: pointer;"><input type="checkbox" id="ms-on"> Milisaniye
                Göster</label>
        </div>

        <button onclick="toggleSettings(event)"
            style="width:100%; background: white; color: black; font-weight: 800; border:none; padding:15px; border-radius:10px;">KAYDET
            VE KAPAT</button>
    </div>

    <script>
        let mode = 'timer', isRunning = false, startTime = 0, elapsedTime = 0, timerDuration = 25 * 60 * 1000;
        let animationFrame, wakeLock = null;
        let presets = [5, 20, 50], selectedPresetIdx = null;
        let vibrateInterval = null, vibrationStartAt = null;

        const icons = { play: '<path d="M8 5v14l11-7z"/>', pause: '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>' };

        window.onload = () => { loadConfig(); renderChips(); updateDisplay(); };

        function stopVibration() {
            if (vibrateInterval) { clearInterval(vibrateInterval); vibrateInterval = null; }
            if (navigator.vibrate) navigator.vibrate(0);
            vibrationStartAt = null;
        }

        function startVibrationLoop() {
            if (!navigator.vibrate || !document.getElementById('vibrate-on').checked) return;

            stopVibration();
            vibrationStartAt = Date.now();
            const level = parseInt(document.getElementById('vib-lvl').value);

            // Yoğunluk simülasyonu: Seviye arttıkça titreşim süresi uzar, bekleme kısalır.
            const vibDuration = level * 100;
            const pauseDuration = (6 - level) * 100;

            vibrateInterval = setInterval(() => {
                const elapsed = Date.now() - vibrationStartAt;
                if (elapsed > 60000) { // 1 Dakika Limit
                    stopVibration();
                    releaseWakeLock(); // Ekranın kapanmasına izin ver
                    return;
                }
                navigator.vibrate(vibDuration);
            }, vibDuration + pauseDuration);
        }

        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try { wakeLock = await navigator.wakeLock.request('screen'); } catch (e) { }
            }
        }

        function releaseWakeLock() {
            if (wakeLock) { try { wakeLock.release(); wakeLock = null; } catch (e) { } }
        }

        function handleGlobalClick() {
            if (document.getElementById('settings-panel').style.display === 'flex') return;

            // Titreşim veya Bitiş Modundaysa Durdur/Sıfırla
            if (vibrateInterval || document.body.classList.contains('timer-finished')) {
                stopVibration();
                reset();
                return;
            }

            if (document.body.classList.contains('focus-active')) {
                document.body.classList.remove('focus-active');
                if (document.getElementById('pause-on').checked && mode !== 'clock') pause();
            }
        }

        function finish() {
            pause(); elapsedTime = timerDuration;
            document.body.classList.add('timer-finished');
            document.getElementById('status-text').style.display = 'block';
            updateDisplay();
            startVibrationLoop();
        }

        // --- Core Functions (V10 tabanlı) ---
        function toggleStart(e) { if (e) e.stopPropagation(); isRunning ? pause() : start(); }
        async function start() {
            if (mode === 'timer' && (elapsedTime === 0 || document.body.classList.contains('timer-finished'))) {
                if (selectedPresetIdx !== null) timerDuration = presets[selectedPresetIdx] * 60 * 1000;
                else {
                    const h = parseInt(document.getElementById('h-in').value) || 0;
                    const m = parseInt(document.getElementById('m-in').value) || 0;
                    const s = parseInt(document.getElementById('s-in').value) || 0;
                    timerDuration = (h * 3600 + m * 60 + s) * 1000;
                }
                elapsedTime = 0;
            }
            startTime = performance.now() - elapsedTime;
            isRunning = true;
            document.body.classList.remove('timer-finished');
            document.getElementById('status-text').style.display = 'none';
            document.body.classList.add('focus-active');
            document.getElementById('btn-text').innerText = "DURDUR";
            document.getElementById('play-icon').innerHTML = icons.pause;
            requestWakeLock();
            tick();
        }
        function pause() { isRunning = false; cancelAnimationFrame(animationFrame); document.getElementById('btn-text').innerText = "DEVAM ET"; document.getElementById('play-icon').innerHTML = icons.play; releaseWakeLock(); }
        function reset(e) { if (e) e.stopPropagation(); stopVibration(); pause(); elapsedTime = 0; document.body.classList.remove('timer-finished', 'focus-active'); document.getElementById('status-text').style.display = 'none'; document.getElementById('btn-text').innerText = "BAŞLAT"; updateDisplay(); }
        function tick() { if (!isRunning && mode !== 'clock') return; const now = performance.now(); elapsedTime = now - startTime; if (mode === 'timer' && (timerDuration - elapsedTime <= 0)) { finish(); return; } updateDisplay(); animationFrame = requestAnimationFrame(tick); }
        function updateDisplay() {
            const disp = document.getElementById('main-display');
            if (mode === 'clock') { disp.innerText = new Date().toLocaleTimeString('tr-TR', { hour12: false }); return; }
            let displayTime = Math.max(0, (mode === 'timer' ? timerDuration - elapsedTime : elapsedTime));
            let totalSec = Math.floor(displayTime / 1000);
            let h = Math.floor(totalSec / 3600), m = Math.floor((totalSec % 3600) / 60), s = totalSec % 60;
            let ms = Math.floor((displayTime % 1000) / 10).toString().padStart(2, '0');
            let timeStr = (h > 0) ? `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}` : `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            disp.innerHTML = `${timeStr}${document.getElementById('ms-on').checked ? `<span class="sub-seconds">${ms}</span>` : ''}`;
        }
        function setMode(m, e) { if (e) e.stopPropagation(); mode = m; document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.dataset.mode === m)); document.getElementById('chip-container').style.display = (m === 'timer' ? 'flex' : 'none'); reset(); if (m === 'clock') tick(); }
        function toggleSettings(e) { if (e) e.stopPropagation(); const p = document.getElementById('settings-panel'); p.style.display = (p.style.display === 'flex' ? 'none' : 'flex'); }
        function toggleFullscreen(e) { if (e) e.stopPropagation(); const doc = document.documentElement; if (!document.fullscreenElement) doc.requestFullscreen(); else document.exitFullscreen(); }
        function applySettings() {
            const root = document.documentElement;
            const size = document.getElementById('f-size').value, weight = document.getElementById('f-weight').value, vLvl = document.getElementById('vib-lvl').value;
            root.style.setProperty('--pulse-color', document.getElementById('c-pulse').value);
            root.style.setProperty('--anim-speed', document.getElementById('p-speed').value + 's');
            document.getElementById('v-anim').innerText = document.getElementById('p-speed').value + 's';
            root.style.setProperty('--text-font', document.getElementById('f-family').value);
            root.style.setProperty('--font-weight', weight);
            root.style.setProperty('--display-size', size + 'vw');
            root.style.setProperty('--bg-color', document.getElementById('c-bg').value);
            root.style.setProperty('--accent-color', document.getElementById('c-txt').value);
            root.style.setProperty('--ms-color', document.getElementById('c-ms').value);
            root.style.setProperty('--chip-bg', document.getElementById('c-chip').value);
            document.getElementById('v-size').innerText = size + 'vw';
            document.getElementById('v-weight').innerText = weight;
            document.getElementById('v-vib-lvl').innerText = vLvl;
            saveConfig(); updateDisplay();
        }
        function saveConfig() {
            const cfg = {
                // Preset ve Zaman Ayarları
                presets: presets,
                selectedPresetIdx: selectedPresetIdx,
                h: document.getElementById('h-in').value,
                m: document.getElementById('m-in').value,
                s: document.getElementById('s-in').value,

                // Font ve Boyut Ayarları
                font: document.getElementById('f-family').value,
                weight: document.getElementById('f-weight').value,
                size: document.getElementById('f-size').value,

                // Renk Ayarları
                c_bg: document.getElementById('c-bg').value,
                c_txt: document.getElementById('c-txt').value,
                c_ms: document.getElementById('c-ms').value,
                c_chip: document.getElementById('c-chip').value,
                c_pulse: document.getElementById('c-pulse').value, // Yeni eklenen

                // Titreşim ve Animasyon Ayarları
                pSpeed: document.getElementById('p-speed').value,  // Yeni eklenen
                vLvl: document.getElementById('vib-lvl').value,
                vibrate: document.getElementById('vibrate-on').checked,

                // Genel Mod Ayarları
                pause: document.getElementById('pause-on').checked,
                ms: document.getElementById('ms-on').checked
            };

            // Veriyi 'focus_pro_v11_cfg' anahtarıyla yerel depoya kaydet
            localStorage.setItem('focus_pro_v11_cfg', JSON.stringify(cfg));
        }
        function loadConfig() {
            const saved = localStorage.getItem('focus_pro_v11_cfg'); if (!saved) { applySettings(); return; }
            const d = JSON.parse(saved); presets = d.presets || [5, 20, 50]; selectedPresetIdx = d.selectedPresetIdx;
            document.getElementById('c-pulse').value = d.c_pulse || "#1a1a1a";
            document.getElementById('p-speed').value = d.pSpeed || 2;
            document.getElementById('h-in').value = d.h; document.getElementById('m-in').value = d.m; document.getElementById('s-in').value = d.s;
            document.getElementById('f-family').value = d.font; document.getElementById('f-weight').value = d.weight; document.getElementById('f-size').value = d.size;
            document.getElementById('c-bg').value = d.c_bg; document.getElementById('c-txt').value = d.c_txt; document.getElementById('c-ms').value = d.c_ms; document.getElementById('c-chip').value = d.c_chip || "#111111";
            document.getElementById('vib-lvl').value = d.vLvl || 3; document.getElementById('vibrate-on').checked = d.vibrate; document.getElementById('pause-on').checked = d.pause; document.getElementById('ms-on').checked = d.ms;
            applySettings(); renderChips();
            if (selectedPresetIdx !== null) timerDuration = presets[selectedPresetIdx] * 60 * 1000; else timerDuration = (d.h * 3600 + d.m * 60 + d.s) * 1000;
        }
        function renderChips() {
            const container = document.getElementById('chip-container'), manager = document.getElementById('chip-manager-list');
            container.innerHTML = ''; manager.innerHTML = '';
            presets.forEach((val, i) => {
                const btn = document.createElement('div'); btn.className = `chip-btn ${selectedPresetIdx === i ? 'active' : ''}`; btn.innerText = val + ' dk'; btn.onclick = (e) => { e.stopPropagation(); selectPreset(i); }; container.appendChild(btn);
                const item = document.createElement('div'); item.className = 'chip-manager-item'; item.style.display = "flex"; item.style.gap = "10px"; item.style.marginBottom = "5px"; item.innerHTML = `<input type="number" value="${val}" onchange="editChip(${i}, this.value)" style="flex:1"><button onclick="removeChip(${i})" style="color:red; border:none; background:none; cursor:pointer;">Sil</button>`; manager.appendChild(item);
            });
        }
        function selectPreset(idx) { if (isRunning) return; selectedPresetIdx = (selectedPresetIdx === idx) ? null : idx; if (selectedPresetIdx !== null) timerDuration = presets[idx] * 60 * 1000; else updateFromCustom(); elapsedTime = 0; renderChips(); updateDisplay(); saveConfig(); }
        function addChip() { presets.push(25); renderChips(); saveConfig(); }
        function editChip(i, val) { presets[i] = parseInt(val) || 1; renderChips(); saveConfig(); }
        function removeChip(i) { presets.splice(i, 1); selectedPresetIdx = null; renderChips(); saveConfig(); updateFromCustom(); }
        function updateFromCustom() { if (isRunning || selectedPresetIdx !== null) return; const h = parseInt(document.getElementById('h-in').value) || 0, m = parseInt(document.getElementById('m-in').value) || 0, s = parseInt(document.getElementById('s-in').value) || 0; timerDuration = (h * 3600 + m * 60 + s) * 1000; elapsedTime = 0; updateDisplay(); saveConfig(); }
    </script>
</body>

</html>